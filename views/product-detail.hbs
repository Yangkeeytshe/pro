<!DOCTYPE html>
<html lang="en">
{{> head pageTitle="Product Details"}}
<body>
{{> header}}

<main>
<style>
  /* Product detail styles using CSS variables */
  .product-detail-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--spacing-lg);
  }

  .product-detail {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-3xl);
    background: white;
    padding: var(--spacing-3xl);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--box-shadow);
    margin-bottom: var(--spacing-2xl);
  }

  .product-image-section {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }

  .main-product-image {
    width: 100%;
    height: 500px;
    object-fit: cover;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--box-shadow);
    transition: var(--transition);
  }

  .main-product-image:hover {
    transform: scale(1.02);
  }

  .product-info-section {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }
  .product-title {
    font-size: var(--font-size-3xl);
    font-weight: 700;
    color: var(--text-dark);
    margin: 0 0 var(--spacing-md) 0;
    line-height: 1.2;
  }

  .product-price {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--primary-color);
    margin: 0 0 var(--spacing-lg) 0;
  }

  .product-rating {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
  }

  .rating-stars {
    color: #ffc107;
    font-size: var(--font-size-lg);
  }

  .rating-text {
    color: var(--text-light);
    font-size: var(--font-size-base);
  }

  .product-category {
    display: inline-block;
    background: var(--background-light);
    color: var(--primary-color);
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--border-radius);
    font-size: var(--font-size-sm);
    font-weight: 600;
    margin-bottom: var(--spacing-lg);
  }

  .flash-message {
    background: #d4edda;
    color: #155724;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid #c3e6cb;
    border-radius: var(--border-radius);
    font-size: var(--font-size-sm);
    margin-bottom: var(--spacing-md);
    text-align: center;
  }
  .product-actions {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
    padding: var(--spacing-xl);
    background: var(--background-light);
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--border-color);
  }

  .size-selector {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .size-selector label {
    font-weight: 600;
    color: var(--text-dark);
    font-size: var(--font-size-base);
  }

  .size-selector select {
    padding: var(--spacing-md);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: var(--font-size-base);
    background: white;
    transition: var(--transition);
  }

  .size-selector select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
  }

  .add-to-cart-btn {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: var(--spacing-lg) var(--spacing-xl);
    border-radius: var(--border-radius);
    font-size: var(--font-size-lg);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
  }

  .add-to-cart-btn:hover {
    background: #1e4080;
    transform: translateY(-2px);
    box-shadow: var(--box-shadow);
  }

  .product-actions {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
  }

  .wishlist-btn-large {
    background: white;
    color: var(--text-dark);
    border: 2px solid var(--border-color);
    padding: var(--spacing-lg) var(--spacing-xl);
    border-radius: var(--border-radius);
    font-size: var(--font-size-base);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    width: 100%;
  }

  .wishlist-btn-large:hover {
    border-color: #dc3545;
    color: #dc3545;
    transform: translateY(-2px);
    box-shadow: var(--box-shadow);
  }

  .wishlist-btn-large.in-wishlist {
    background: #dc3545;
    color: white;
    border-color: #dc3545;
  }

  .wishlist-btn-large.in-wishlist:hover {
    background: #c82333;
    border-color: #c82333;
  }

  .payment-options {
    padding: var(--spacing-lg);
    background: white;
    border-radius: var(--border-radius);
    border: 1px solid var(--border-color);
  }

  .payment-options h4 {
    margin: 0 0 var(--spacing-md) 0;
    color: var(--text-dark);
    font-size: var(--font-size-lg);
  }

  .payment-options p {
    margin: var(--spacing-sm) 0;
    color: var(--text-light);
    font-size: var(--font-size-base);
  }

.reviews-section {
  max-width: 1200px;
  margin: var(--spacing-2xl) auto;
  padding: var(--spacing-2xl) var(--spacing-lg);
  background: white;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--box-shadow);
  font-family: var(--font-family-primary);
  color: var(--text-dark);
}

.reviews-section h2 {
  font-size: var(--font-size-2xl);
  font-weight: 700;
  color: var(--text-dark);
  margin: 0 0 var(--spacing-2xl) 0;
  text-align: center;
}

.reviewer-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: var(--spacing-md);
  border: 2px solid var(--border-color);
}

.reviews-list {
  list-style: none;
  padding: 0;
  margin: 0 0 var(--spacing-2xl) 0;
}

.review-item {
  background: var(--background-light);
  border-radius: var(--border-radius);
  padding: var(--spacing-xl);
  margin-bottom: var(--spacing-lg);
  border: 1px solid var(--border-color);
  transition: var(--transition);
}

.review-item:hover {
  box-shadow: var(--box-shadow);
  border-color: var(--primary-color);
}

.review-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-md);
}

.reviewer-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.reviewer-name {
  font-weight: 600;
  color: var(--text-dark);
  font-size: var(--font-size-base);
}

.review-rating {
  color: #ffc107;
  font-size: var(--font-size-base);
  font-weight: 600;
}

.review-text {
  margin-bottom: var(--spacing-lg);
  line-height: 1.6;
  color: var(--text-light);
}

.review-votes {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.review-votes button {
  cursor: pointer;
  border: none;
  background: var(--background-light);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--border-radius);
  font-size: var(--font-size-base);
  color: var(--text-light);
  transition: var(--transition);
  border: 1px solid var(--border-color);
}

.review-votes button:hover {
  background: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

.review-votes span {
  font-size: var(--font-size-sm);
  color: var(--text-light);
  margin-left: var(--spacing-xs);
}

.delete-review-btn {
  background: #dc3545 !important;
  color: white !important;
  border-color: #dc3545 !important;
}

.delete-review-btn:hover {
  background: #c82333 !important;
  border-color: #bd2130 !important;
}

.review-form {
  background: var(--background-light);
  padding: var(--spacing-2xl);
  border-radius: var(--border-radius-lg);
  border: 1px solid var(--border-color);
  margin-top: -20px;
}

.review-form h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--text-dark);
  margin: 0 0 var(--spacing-lg) 0;
}

.review-form label {
  font-weight: 600;
  color: var(--text-dark);
  margin-bottom: var(--spacing-xs);
  display: block;
}

.review-form select,
.review-form textarea {
  width: 100%;
  padding: var(--spacing-md);
  font-size: var(--font-size-base);
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  font-family: var(--font-family-primary);
  margin-bottom: var(--spacing-lg);
  transition: var(--transition);
}

.review-form select:focus,
.review-form textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
}

.review-form button {
  background: var(--primary-color);
  color: white;
  border: none;
  padding: var(--spacing-md) var(--spacing-xl);
  border-radius: var(--border-radius);
  font-size: var(--font-size-base);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.review-form button:hover {
  background: #1e4080;
  transform: translateY(-2px);
}


  /* Left image */
  .product-detail > div:first-child {
    flex: 0 0 350px;
    max-width: 350px;
  }

  .product-detail > div:first-child img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  /* Middle product info */
  .product-detail > div:nth-child(2) {
    flex: 1 1 400px;
    padding-left: 40px;
  }

  .product-detail > div:nth-child(2) h1 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 2rem;
  }

  .price {
    font-size: 1.5rem;
    color: #2c3e50; /* dark neutral blue */
    margin-bottom: 15px;
  }

  .product-detail p {
    margin: 6px 0;
    font-size: 1rem;
  }

  .product-actions {
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .product-actions label {
    font-weight: 600;
  }

  select#size {
    padding: 6px 10px;
    font-size: 1rem;
    border-radius: 4px;
    border: 1px solid #ccc;
    background: white;
  }

  .product-form button.cart-link {
    background-color: #3498db;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    color: white;
    font-size: 1.2rem;
    transition: background-color 0.3s ease;
  }

  .product-form button.cart-link:hover {
    background-color: #2980b9;
  }

  .payment-options {
    margin-top: 30px;
    font-size: 1rem;
  }

  .payment-options p {
    margin: 5px 0;
  }

  /* Recommendations section */
  .recommendations-section {
    background: white;
    padding: var(--spacing-2xl);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--box-shadow);
    margin-bottom: 0;
  }

  .recommendations-section h3 {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--text-dark);
    margin: 0 0 var(--spacing-xl) 0;
    text-align: center;
  }

  .recommendations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-lg);
  }

  .recommendation-item {
    background: var(--background-light);
    border-radius: var(--border-radius);
    overflow: hidden;
    transition: var(--transition);
    border: 1px solid var(--border-color);
  }

  .recommendation-item:hover {
    transform: translateY(-3px);
    box-shadow: var(--box-shadow);
    border-color: var(--primary-color);
  }

  .recommendation-item a {
    text-decoration: none;
    color: inherit;
    display: block;
  }
.recommendation-item img {
  width: 100%;
  height: 240px; /* increased for better visibility */
  object-fit: cover;
  display: block;
  aspect-ratio: 4 / 3; /* maintains consistent size across all */
  border-bottom: 1px solid var(--border-color);
  transition: transform 0.3s ease;
}


  .recommendation-item:hover img {
    transform: scale(1.05);
  }

  .recommendation-content {
    padding: var(--spacing-md);
  }

  .recommendation-title {
    font-size: var(--font-size-base);
    font-weight: 600;
    color: var(--text-dark);
    margin: 0 0 var(--spacing-xs) 0;
    line-height: 1.3;
  }

  .recommendation-price {
    font-size: var(--font-size-sm);
    color: var(--primary-color);
    font-weight: 600;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .product-detail {
      grid-template-columns: 1fr;
      gap: var(--spacing-2xl);
      padding: var(--spacing-xl);
    }

    .main-product-image {
      height: 400px;
    }

    .product-title {
      font-size: var(--font-size-2xl);
    }

    .recommendations-grid {
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-md);
    }

    .recommendation-item img {
      height: 120px;
    }
  }

  @media (max-width: 576px) {
    .product-detail-container {
      padding: var(--spacing-md);
    }

    .product-detail {
      padding: var(--spacing-lg);
    }

    .main-product-image {
      height: 300px;
    }

    .product-actions {
      padding: var(--spacing-lg);
    }

    .recommendations-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="product-detail-container">
  <section class="product-detail">
    <!-- Product Image Section -->
    <div class="product-image-section">
      <img src="{{product.image}}" alt="{{product.name}}" class="main-product-image">
    </div>

    <!-- Product Info Section -->
    <div class="product-info-section">
      <h1 class="product-title">{{product.name}}</h1>
      <div class="product-price">Nu {{product.price}}</div>

      <div class="product-rating">
        <div class="rating-stars">
          {{#times product.rating}}★{{/times}}{{#times (subtract 5 product.rating)}}☆{{/times}}
        </div>
        <span class="rating-text">({{product.rating}}/5)</span>
      </div>

      <div class="product-category">{{product.category}}</div>

      <div class="product-actions">
        {{#if success_msg}}
          <div class="flash-message">{{success_msg}}</div>
        {{/if}}

        <div class="size-selector">
          <label for="size">Select Size:</label>
          <select id="size" name="size">
            <option value="">Choose a size</option>
            <option value="XS">XS</option>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
          </select>
        </div>

        <div class="product-actions">
          <form action="/cart/add/{{product.id}}" method="POST" class="product-form">
            <input type="hidden" name="name" value="{{product.name}}" />
            <input type="hidden" name="price" value="{{product.price}}" />
            <input type="hidden" name="image" value="{{product.image}}" />

            
       <button type="submit" class="cart-link" style="background: linear-gradient(135deg, var(--primary-color), #0e8aa940); border: none; color: white;">
  <i class="fa-solid fa-cart-shopping cart"></i>
  
          </form>

          <button type="button" class="wishlist-btn-large" data-product-id="{{product.id}}">
            <i class="far fa-heart"></i>
            <span class="wishlist-text">Add to Wishlist</span>
          </button>
        </div>
      </div>

      <div class="payment-options">
        <h4>Payment Options</h4>
        <p><strong>ZipPay:</strong> from Nu {{calculateWeekly product.price}} per week</p>
        <p><strong>Afterpay:</strong> 4 payments of Nu {{calculateAfterpay product.price}}</p>
      </div>
    </div>
  </section>

  <!-- Recommendations Section -->
  {{#if recommendations.length}}
  <section class="recommendations-section">
    <h3>You May Also Like</h3>
    <div class="recommendations-grid">
      {{#each recommendations}}
        <div class="recommendation-item">
          <a href="/product/{{id}}">
            <img src="{{image}}" alt="{{name}}">
            <div class="recommendation-content">
              <div class="recommendation-title">{{name}}</div>
              <div class="recommendation-price">Nu {{price}}</div>
            </div>
          </a>
        </div>
      {{/each}}
    </div>
  </section>
  {{/if}}
</div><section class="reviews-section">
  <h2>Reviews</h2>

  {{#if reviews.length}}
    <ul class="reviews-list">
      {{#each reviews}}
        <li class="review-item" data-review-id="{{review_id}}">
          <div class="review-header">
            <div class="reviewer-info">
              <img src="{{reviewer_profilePic}}" alt="{{reviewer_name}}'s profile picture" class="reviewer-avatar">
              <span class="reviewer-name">{{reviewer_name}}</span>
            </div>
            <div class="review-rating">
              {{#times star_rating}}★{{/times}}{{#times (subtract 5 star_rating)}}☆{{/times}}
              ({{star_rating}}/5)
            </div>
          </div>

          <p class="review-text">{{review_text}}</p>

          <div class="review-votes">
            <button class="upvote-btn" data-review-id="{{review_id}}" aria-label="Upvote">
              👍 <span class="upvote-count">{{upvotes}}</span>
            </button>
            <button class="downvote-btn" data-review-id="{{review_id}}" aria-label="Downvote">
              👎 <span class="downvote-count">{{downvotes}}</span>
            </button>
            <button class="delete-review-btn" data-review-id="{{review_id}}" aria-label="Delete Review">
              🗑️ Delete
            </button>
          </div>
        </li>
      {{/each}}
    </ul>

  {{else}}
    <p>No reviews yet. Be the first to review this product!</p>
  {{/if}}

  <!-- Review form -->
  <form class="review-form" method="POST" action="/product/{{product.id}}/review">
    <h3>Write a Review</h3>

    <label for="star_rating">Rating:</label>
    <select id="star_rating" name="star_rating" required>
      <option value="">Select a rating</option>
      <option value="5">5 - Excellent</option>
      <option value="4">4 - Good</option>
      <option value="3">3 - Average</option>
      <option value="2">2 - Poor</option>
      <option value="1">1 - Terrible</option>
    </select>

    <label for="review_text">Your Review:</label>
    <textarea id="review_text" name="review_text" rows="4" required placeholder="Write your review here..."></textarea>

    <button type="submit">Submit Review</button>
  </form>
</section>

<script>// Remove individual button listeners, instead delegate on container
document.querySelector('.reviews-list').addEventListener('click', async (e) => {
  const target = e.target;

  if (target.classList.contains('upvote-btn') || target.classList.contains('downvote-btn')) {
    const reviewId = target.dataset.reviewId;
    const voteType = target.classList.contains('upvote-btn') ? 'upvote' : 'downvote';

    try {
      const response = await fetch(`/reviews/${reviewId}/vote`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ voteType })
      });

      if (!response.ok) throw new Error('Vote failed');

      const data = await response.json();

      const reviewItem = document.querySelector(`li[data-review-id="${reviewId}"]`);
      reviewItem.querySelector('.upvote-count').textContent = data.upvotes;
      reviewItem.querySelector('.downvote-count').textContent = data.downvotes;

    } catch (error) {
      alert('Unable to submit vote, please try again.');
    }
  }
});


</script>


{{> footer}}

<!-- Include Chatbot Widget -->
{{> chatbot}}

<!-- Wishlist JavaScript -->
<script src="/js/wishlist-manager.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize wishlist functionality
    if (window.wishlistManager) {
      window.wishlistManager.updateWishlistButtons();
      window.wishlistManager.updateWishlistCount();
    }

    // Handle large wishlist button
    const wishlistBtnLarge = document.querySelector('.wishlist-btn-large');
    if (wishlistBtnLarge) {
      wishlistBtnLarge.addEventListener('click', function() {
        const productId = this.dataset.productId;
        window.wishlistManager.toggleWishlist(productId, this);
      });
    }
  });
    document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.wishlist-btn').forEach(button => {
      button.addEventListener('click', function () {
        const productId = this.getAttribute('data-product-id');
        
        // Optional: Toggle icon style
        const icon = this.querySelector('i');
        if (icon.classList.contains('far')) {
          icon.classList.remove('far');
          icon.classList.add('fas'); // filled heart
          icon.style.color = 'red';
        } else {
          icon.classList.remove('fas');
          icon.classList.add('far'); // outline heart
          icon.style.color = '#666';
        }

</script>

</main>
</body>
</html>
